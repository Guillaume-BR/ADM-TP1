\documentclass{article}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsfonts}
\usepackage{dsfont}
\usepackage{graphicx} % Required for inserting images
\usepackage{listings}
\usepackage{array}
\usepackage[vmargin=2cm,hmargin=1cm]{geometry}


\title{TP1-ADM}
\author{Guillaume Bernard-Reymond et Lorenzo Gaggini}
\date{October 2023}

\begin{document}
\newcommand{\norme}[1]{\left\| #1\right\|}

\maketitle

Dans ce TP, nous avons à notre disposition un tableau contenant une liste de 21 vins dont on a mesuré différents paramètres. En voici un extrait : 

\begin{table}[ht]
\centering
\begin{tabular}{rlllrr}
  \hline
 & X & Label & Soil & Odor.Intensity.before.shaking & Aroma.quality.before.shaking \\ 
  \hline
1 & 2EL  & Saumur & Env1 & 3.074 & 3.000 \\ 
  2 & 1CHA & Saumur & Env1 & 2.964 & 2.821 \\ 
  3 & 1FON & Bourgueuil & Env1 & 2.857 & 2.929 \\ 
  4 & 1VAU & Chinon & Env2 & 2.808 & 2.593 \\ 
   \hline
\end{tabular}
\caption{Extrait du tableau} 
\end{table} 

Dans la première partie, nous avons fait le choix de ne pas utiliser le calcul matriciel pour obtenir les résultats attendus, la seconde partie étant justement présente pour valider par le calcul matriciel certains résultats obtenus dans la partie 1. Nous garderons les variables qualitatives dans nos tableaux et arrondirons nos résultats à $10^{-3}$ près. 

On trouvera le code utilisé, en annexe à la fin.

\section{Partie 1}
Dans cette partie, nous désignerons par $(x_{i})$ où $i\in\{1;...;21\}$ les individus et $(x^{j})$ où $j\in\{1;...;32\}$ les variables, qu'elles soient quantitatives ou bien qualitatives. Enfin nous noterons $(z^{j})$ où $j\in\{4;...;32\}$ les variables quantitatives centrées-réduites. 
\begin{enumerate}
    \item Dans cette question, nous nous plaçons dans le cas général où $i\in\{1;...;n\}$ et $j\in\{1;...;p\}$
    \begin{itemize}
        \item[$\bullet$] On considère $(w_{i})_{i\in\{1...n\}}$ une suite de poids telle que $\displaystyle\sum_{i=1}^{n} w_i=1$ et soit $j\in\{1;...;p\}$. On peut alors écrire : 
        \begin{align*}
            \sum_{i=1}^{n} w_i z_i^j = & \sum_{i=1}^{n} w_i \left(\dfrac{x_i^j-\overline{x^j}}{\sigma_{x^j}}\right)\\
            =& \dfrac{1}{\sigma_{x^j}}\sum_{i=1}^{n}\left(w_i x_{i}^j-w_i \overline{x^j}\right) \\
            =&\dfrac{1}{\sigma_{x^j}} \left(\overline{x^j}-\overline{x^j}\sum_{i=1}^{n} w_i\right)\\
            =& 0
        \end{align*}
    Le barycentre du nuage est donc bien $0_{\mathbb{R}^{p}}$.
    
    Informatiquement, voici un extrait de ce que nous avons obtenu : 
    
    \begin{table}[ht]
\centering
\begin{tabular}{rrrrrr}
  \hline
 & Odor.Intensity.before.shaking & Aroma.quality.before.shaking & Fruity.before.shaking & Flower.before.shaking \\ 
  \hline
1 & -0.000 & 0.000 & -0.000 & 0.000 \\ 
   \hline
\end{tabular}
\caption{extrait du tableau des barycentres} 
\end{table}
    
R nous affiche des résultats de l'ordre de $10^{-16}$, on peut donc considérer qu'ils sont égaux à $0$.

    \item[$\bullet$] Calcul de l'inertie  par rapport à l'origine pour nos variables centrées-réduites : 
    \begin{align*}
       In_{O}\left(\{z_i;w_i\}_{i=1,...,n}\right) = & \sum_{i=1}^{n} w_i \norme{z_{i}}^2 \\
       = & \sum_{i=1}^{n} w_i \left(\sum_{j=1}^p {z_i^j}^2\right)\\
       =& \sum_{i=1}^{n} \left(\sum_{j=1}^p w_i {z_i^j}^2\right) \\
       =& \sum_{j=1}^p \left( \sum_{i=1}^{n}w_i {z_i^j}^2\right)
    \end{align*}
    Or l'expression $\displaystyle \sum_{i=1}^{n}w_i {z_i^j}^2$ n'est rien d'autre que l'expression de la variance de notre variable quantitative centrée réduite qui vaut donc $1$. 

    Ainsi : $In_{O}\left(\{z_i;w_i\}_{i=1,...,n}\right) = p$ c'est à dire le nombre de variables quantitatives.
    
    Informatiquement, voici ce que nous avons obtenu : 

\begin{table}[ht]
\centering
\begin{tabular}{rrrrr}
  \hline
 & Odor.Intensity.before.shaking & Aroma.quality.before.shaking & Fruity.before.shaking & Flower.before.shaking \\ 
  \hline
1 & 1.000 & 1.000 & 1.000 & 1.000 \\ 
   \hline
\end{tabular}
\caption{extrait du tableau des variances} 
\end{table}  

En sommant toutes ces variances, on obtient bien l'inertie qui est alors de $29$.  
    \end{itemize}

\item Pour chaque appellation, nous avons effectuer un tri afin d'obtenir pour chaque appellation un tableau des individus. A partir de là, nous avons calculé le poids, les barycentres et les normes euclidiennes carrées de ces trois barycentres : 

Voici un extrait d'un des tableaux : 

\begin{table}[ht]
\centering
\begin{tabular}{rlllrr}
  \hline
 & X & Label & Soil & Odor.Intensity.before.shaking & Aroma.quality.before.shaking \\ 
  \hline
4 & 1VAU & Chinon & Env2 & -1.047 & -2.202 \\ 
  9 & DOM1 & Chinon & Env1 & -0.878 & -1.122 \\ 
  17 & 2BEA & Chinon & Reference & -0.260 & 0.648 \\ 
   \hline
\end{tabular}
\caption{extrait du tableau de l'appelation Chinon} 
\end{table}

Voici les résultats obtenus : 

% \usepackage{array} is required
\begin{center}
\begin{tabular}{|l|>{\centering\arraybackslash}p{3cm}|>{\centering\arraybackslash}p{3cm}|}
\hline 
 & Poids & Norme \\ 
\hline 
Chinon & 0,190 & 5,400\\ 
\hline 
Saumur & 0,524 & 2,120\\ 
\hline 
Bourgueuil & 0,286 & 3,604 \\ 
\hline 
\end{tabular} 
\end{center}

\textbf{Inertie inter-appellation $In_{\text{inter}}$ :}

\begin{align*}
In_{\text{inter}}=&\sum_{k=1}^3 W^k\norme{\overline{x}^k}^2\\
\approx& 3,169
\end{align*}

\textbf{Calcul du $R^2$ de la partition des vins en appellation :} 
\begin{align*}
R^2=&\frac{\text{Inertie inter-appellation}}{\text{Inertie du nuage}}\\
\approx& 0,109
\end{align*}

Le rapport entre l'inertie des points moyens des appellations par rapport à l'inertie du nuage est dons d'environ $11\%$. Ce nombre représente  donc l'impact des appellations sur la dispersion des variables sensorielles. 

 
%Faux de là à ...
\item Pour chaque variable sensorielle, nous avons calculer le $R^2$. Nous avons donc obtenu $3$ vecteurs lignes de $29$ valeurs. Nous avons ensuite triés les valeurs et tracés les graphiques correspondant.

Pour le Bourgueil :
\begin{itemize}
\item[$\bullet$] la moins liée : Spice.before.shaking
\item[$\bullet$] la plus liée : Attack.intensity  
\end{itemize}

Pour le Chinon :
\begin{itemize}
\item[$\bullet$] les moins liées : Spice.before.shaking et Astringency 
\item[$\bullet$] les plus liées par ordre croissant : Fruity , Aroma.intensity , Acidity   
\end{itemize}

Pour le Saumur :
\begin{itemize}
\item[$\bullet$] la moins liée : Surface.feeling 
\item[$\bullet$] les plus liées par ordre croissant : Flower , Spice , Spice.before.shaking. 
\end{itemize}
%... à de là.

Nous avons calculé le $R^2$, pour chaque variable sensorielle, rangé par ordre croissant les valeurs de ce vecteur ligne et tracé le graphique correspondant.  Trois variables se détachent nettement des autres :

\textbf{Variables les plus liées à l'appellation :} 
	\begin{itemize}
	\item[$\bullet$] Odor.Intensity : 0.391
	\item[$\bullet$] Phenolic : 0.360
	\item[$\bullet$] Odor.Intensity.before.shaking 0.342
	\end{itemize}
	
\textbf{Variables les moins liées à l'appellation :}

\begin{itemize}
\item[$\bullet$] Fruity : 0.007
\item[$\bullet$] Quality.of.odour : 0.008 
\end{itemize}




Montrons que le $R^2$ de la partition est égal à la moyenne arithmétique des $R^2$ des variables que l'on notera $M$. 
\begin{align*}
M=& \frac{1}{29} \sum_{j=1}^{29} \frac{\text{Variance externe de la variable } j }{\text{Variance totale de la variable} j} \\ 
 =& \frac{1}{29} \sum_{j=1}^{29} \frac{\sum_{k=1}^3 W^k\left(\overline{x^j}^k\right)^2}{1} \\
  =&\frac{1}{29} \sum_{k=1}^3  W^k \sum_{j=1}^{29} \left(\overline{x^j}^k\right)^2 \\
   =& \frac{1}{29} \sum_{k=1}^3 W^k \norme{\overline{x}^k}^2\\
 =& R^2_{\text{partition}}
\end{align*}

Informatiquement, nous avons d'abord la variance inter-appellation pour chaque variable sensorielle , nous formant ainsi un vecteur ligne à 29 colonnes. Puis en sommant ces valeurs et en divisant par le nombre de valeur, ici 29, nous avons bien retrouvé la valeur du $R^2$ de la question \textbf{2.} à savoir $0,109$.
\end{enumerate}

\section{Partie 2}

\begin{enumerate}
\item 
	\begin{enumerate}
	\item On considère le vecteur $\mathds{1}_n=\begin{pmatrix}
	1 \\ 
	\vdots \\ 
	 \\ 
	1
	\end{pmatrix} \in\mathbb{R}^{n}$.\\
	 On rappelle que $\mathds{1}_n\in \text{Vect}\left(y^1;...;y^p\right)=\langle Y \rangle$ car $\forall i\in\{1;...;n\},\, \sum_{j=1}^p \mathds{1}_{Y_i=j}=1$ donc $\mathds{1}_n\in \langle Y \rangle$.
Soit $j\in\{1;...;p\}$ :
	\begin{align*}
	\Pi_{\langle Y \rangle} x^j =& \Pi_{\langle\mathds{1}_n\rangle}x^j +\Pi_{\langle \mathds{1}_n^{\perp} \cap Y \rangle} x^j  \text{ car } \langle Y \rangle = \langle \mathds{1}_n \rangle \overset{\perp}{\oplus}\langle \mathds{1}_n^{\perp} \cap Y \rangle \\
	  =& 0 + \Pi_{\langle Y^c \rangle} x^j \\
	  =& \Pi_{\langle Y^c \rangle} x^j
	\end{align*}
 $\Pi_{\langle\mathds{1}_n\rangle}x^j=0$ car $x^j$ étant centré réduit, il appartient à $\mathds{1}_n^{\perp}$.\\
 
	
	$\norme{\Pi_Yx^j}^2_{W}$ représente la variance de la variable $x^j$ par rapport à l'appellation.
	\item $\Pi_Y=Y\left(Y'WY\right)^{-1}Y'W$ est une matrice carrée de taille $21$ et de même pour $\Pi_{x^j}=x^{j}\left({x^{j}}'Wx^{j}\right)^{-1}{x^{j}}'W$
	
	\item $\text{tr}(R \Pi_Y)$ est le $R^2$ de la partition des vins en appellations.
	
	\item 
	\end{enumerate}

\item De la même façon, $\text{tr}(\Pi_{x^j}\Pi_{Z})$ est ... et $\text{tr}(R\Pi_{Z})$ est le $R^2$ de la partition des vins selon les types de sol.
\end{enumerate}

\newpage

\appendix 
\section{Code R}



\end{document}
